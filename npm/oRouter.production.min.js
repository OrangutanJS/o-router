"use strict";function renderIfHtmlElementGiven(t,e=document.body){if(!t)return;const r=t=>{e.innerHTML="",e.appendChild(t)};if(t instanceof HTMLElement&&r(t),t.init&&"function"==typeof t.init){const e=t.init();e instanceof HTMLElement&&r(e)}}function routesFilter(t,e){let r=Object.keys(e).map((t=>({full:t,splitted:t.split("/").filter((t=>""!==t))}))).filter((e=>e.splitted.length===t.length));for(let e=0;e<t.length;e++)r=r.filter((r=>r.splitted[e]===t[e]||r.splitted[e].startsWith(":")));return r}function setOnPopStateEvent(){window.onpopstate||(window.onpopstate=function(t){t.preventDefault(),oRouter.route()})}function decodeSearchQuery(t){const e=Object.create(null);if("string"!=typeof t||!t.length||!t.startsWith("?"))return e;return t.substring(1).split("&").forEach((t=>{const[r,o]=t.split("=");e[decodeURIComponent(r)]=decodeURIComponent(o)})),e}function createUrlObject(t,e=""){return"object"==typeof t&&t instanceof URL?t:t||""===t?new URL(window.location.origin+e+t):new URL(window.location.href)}function splitAndFilterPath(t,e=""){const r=e.startsWith("/")?e.substring(1):e;return t.split("/").filter((t=>""!==t&&t!==r))}const FORBIDDEN_PARAMETERS=["fullPath","url","hash","searchParameters"];function decodeParameters(t,e){const r={};return t.splitted.forEach(((t,o)=>{if(t.startsWith(":")){const a=t.replace(":","");if(FORBIDDEN_PARAMETERS.includes(a))return;r[a]=e[o]}})),r}function encodeSearchQuery(t){if(!t||"object"!=typeof t)return"";let e="?";return e+=Object.entries(t).filter((t=>searchParametersFilter(t))).map((t=>searchParametersMapper(t))).join("&"),e.substring(1).length?e:""}function searchParametersFilter([,t]){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t}function searchParametersMapper([t,e]){return`${encodeURIComponent(t)}=${encodeURIComponent(e)}`}class oRouter{static originPrefix="";static routingTable={};static#t={};static set defaultView(t){if(!t||"function"!=typeof t)throw new Error("Not valid defaultView parametereter.");oRouter.#e=t}static get routingParameters(){return oRouter.#t}static set routingParameters(t){return t}static#e=()=>null;static redirect(t,e){oRouter.route(t,e)}static route(t,e){setOnPopStateEvent();const r=createUrlObject(t,oRouter.originPrefix);oRouter.#t={fullPath:r.href.replace(r.origin,""),url:r,searchParameters:decodeSearchQuery(r.search),hash:r.hash,parameters:{}},"object"==typeof e&&Object.assign(oRouter.#t,e);const o=splitAndFilterPath(r.pathname,oRouter.originPrefix);if(!o.length)return oRouter.#r(r),renderIfHtmlElementGiven(oRouter.#e(oRouter.#t)),!0;const a=routesFilter(o,oRouter.routingTable);if(!a.length){const{url:t}=oRouter.#t;return!!oRouter.routingTable["404-notFound"]&&(oRouter.#r(t),renderIfHtmlElementGiven(oRouter.routingTable["404-notFound"](oRouter.#t)),!1)}const n=a[0];return Object.assign(oRouter.#t.parameters,decodeParameters(n,o)),oRouter.#r(r),renderIfHtmlElementGiven(oRouter.routingTable[n.full](oRouter.#t)),!0}static setSearchParameter(t,e){return!(!t||"string"!=typeof t||"object"==typeof e)&&oRouter.setSearchParameters({[t]:String(e)})}static unsetSearchParameter(t){if(!oRouter.#t.searchParameters[t])return!1;delete oRouter.#t.searchParameters[t];const{url:e}=oRouter.#t;let r=oRouter.#o();return e.search=`?${r}`,oRouter.#r(e)}static setSearchParameters(t){if("object"!=typeof t)return!1;if(!Object.keys(t).length)return!0;const{url:e}=oRouter.#t;return e.search=oRouter.#o(t),oRouter.#r(e)}static unsetSearchParametersAll(){const{url:t}=oRouter.#t,e=decodeSearchQuery(t.search);return Object.keys(e).forEach((t=>oRouter.unsetSearchParameter(t))),oRouter.#r(t)}static setHash(t){if(!t||"object"==typeof t)return!1;t=String(t);const{url:e}=oRouter.#t;t.startsWith("#")&&(t=t.substring(1));return!!new RegExp(`#?${t}(#|$)`,"i").test(e.hash)||(e.hash+="#"+t,oRouter.#r(e))}static unsetHash(t){if(!t||"object"==typeof t)return!1;t=String(t);const{url:e}=oRouter.#t;t.startsWith("#")&&(t=t.substring(1));const r=new RegExp(`#?${t}(#|$)`,"i");return e.hash=e.hash.replace(r,""),oRouter.#r(e)}static unsetHashAll(){const{url:t}=oRouter.#t;t.hash.split("#").filter((t=>""!==t)).forEach((t=>oRouter.unsetHash(t)))}static isSetHash(t){const e=new RegExp(`#?${t}(#|$)`),{url:r}=oRouter.#t;return e.test(r.hash)}static back(){window.history.back()}static#o(t){return t&&Object.assign(oRouter.#t.searchParameters,t),encodeSearchQuery(oRouter.#t.searchParameters)}static#r(t){const{pathname:e}=t;oRouter.#t.fullPath=t.href.replace(t.origin,"");try{if(e===window.location.pathname)window.history.replaceState(JSON.parse(JSON.stringify(oRouter.#t)),document.title,t);else{const e={...oRouter.#t,redirectedFrom:window.location.pathname};window.history.pushState(JSON.parse(JSON.stringify(e)),document.title,t)}return!0}catch(t){return console.warn(t),!1}}}module.exports=oRouter;